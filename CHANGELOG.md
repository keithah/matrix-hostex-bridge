# Changelog

## [0.1.1] - 2025-07-23 - Double Puppeting Fix

### Fixed
- **Double Puppeting**: Host messages now appear as sent by the actual Matrix user instead of received messages from the bridge bot
- **configupgrade.SimpleUpgrader**: Fixed to properly copy configuration fields instead of empty upgrader
- **Bridge Naming**: Updated to use `sh-hostex` prefix for proper Beeper compatibility

### Changed
- **Configuration**: Now supports bridgev2 configuration generated by `bbctl config --type bridgev2 sh-generic`
- **Metadata Structures**: Cleaned up unnecessary fields from Portal/Ghost/UserLogin metadata
- **HTTP Endpoints**: Added proper webhook endpoints following mautrix-go bridgev2 patterns

### Added
- **HTTP Endpoints**: Registered webhook endpoints at `/_matrix/mau/hostex/webhook` and `/_matrix/mau/hostex/health`
- **Double Puppeting Config**: Automatic double puppeting using Beeper's `as_token`
- **Network Configuration**: Added dedicated network section for Hostex-specific settings

### Technical Details

#### Double Puppeting Implementation
- Fixed `queueMessageEvent` function to use proper `senderID` instead of empty string
- Set `SenderLogin` to `hn.login.ID` when `isFromMe` is true
- Updated EventSender configuration to enable proper double puppeting

#### Configuration Changes
- Updated bridge to use `sh-hostexbot` as bot username
- Changed username template to `sh-hostex_{{.}}`  
- Added proper `as_token` configuration for automatic double puppeting
- Integrated with bbctl-generated bridgev2 configuration

#### Code Improvements
- Simplified metadata structures to remove redundant fields
- Added HTTP endpoint registration following Twilio bridge example
- Fixed configupgrade.SimpleUpgrader to copy fields properly

### Migration Guide

If upgrading from version 0.1.0:

1. **Generate new config**: Use `bbctl config --type bridgev2 sh-generic -o config.yaml`
2. **Update config**: Add network section with your Hostex API settings
3. **Update tokens**: Use actual tokens from `registration.yaml`
4. **Restart bridge**: Double puppeting should now work properly

### Breaking Changes
- Configuration format changed from standalone to bridgev2 format
- Bridge bot username changed from `hostexbot` to `sh-hostexbot`
- Username template changed from `hostex_{{.}}` to `sh-hostex_{{.}}`

## [0.1.0] - 2025-07-22 - Initial Release

### Added
- Basic Matrix bridge functionality for Hostex property management
- Bidirectional messaging between Matrix and Hostex
- Image attachment support
- Message backfilling
- Beeper integration
- Real-time polling every 30 seconds
- Manual refresh commands